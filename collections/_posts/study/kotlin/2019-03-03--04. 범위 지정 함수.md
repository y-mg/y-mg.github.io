---
layout: post
title: "범위 지정 함수"
date: 2019-03-03T00:00:01Z
authors: ["y-mg"]
categories: [Kotlin]
description: "apply / run / with / let / also"
thumbnail: "/assets/images/study/kotlin/kotlin.png"
image: "/assets/images/study/kotlin/kotlin.png"
comments: false
---

## 수신 객체 지정 람다 (람다 리시버, Lambda Receiver)
코드를 사용하다보면 사용하는 객체를 반복해서 명시하는 경우가 많은데, 수신 객체 지정 람다는 이런 수신 객체를 명시하지 않고 람다의 본문 안에서 다른 객체의 메소드를 호출할 수 있게 하는 것을 말한다.
<br/>
<br/>


## apply
수신 객체의 내부 프로퍼티를 변경한 후 수신객체 자신을 반환하는 함수이다.
- 람다식의 수신 객체가 <code style="color: #eb5657;">apply</code> 의 수신 객체여서 수신 객체에 대한 명시(<code style="color: #eb5657;">this</code>)를 생략하는 것이 가능
- 객체 생성 시에 다양한 프로퍼티를 설정해야 하는 경우에 사용

```kotlin
// fun <T> T.apply(block: T.() -> Unit): T
fun main() {
    val user = User().apply {
        name = "BBB"
        age = 20
    }
}

data class User(
    var name: String = "AAA", 
    var age: Int = 0
)
```
<br/>
<br/>


## run
<code style="color: #eb5657;">apply</code> 와 같은 동작을 하지만 수신 객체 자신을 반환하지 않고 <code style="color: #eb5657;">run</code> 블록의 마지막 라인을 반환하는 함수이다.
- 수신객체에 대한 특정한 동작 수행 후 결과값을 반환 받아야 할 경우 사용

```kotlin
// fun <T, R> T.run(block: T.() → R): R
fun main() {
    var str: String = "TEST code"
    str = str?.run {
        println(this.toUpperCase())
        println(toLowerCase())
        "Complete"
    }
    println(str)
}

// TEST CODE
// test code
// Complete
```

```kotlin
// fun <R> run(block: () → R): R
fun main() {
    val result = run {
        val items = 10
        val price = 1000
        val discountPercent = 10.0
        ((items * price) * ((100 - discountPercent) * 0.01)).toInt()
    }
    println ("가격 : ${result}원 ")
}

// 가격 : 9000원
```
<br/>
<br/>


## with
<code style="color: #eb5657;">run</code> 과 같은 동작을 하는 함수로, <code style="color: #eb5657;">run</code> 은 확장 함수로 사용이 되는데 <code style="color: #eb5657;">with</code> 는 수신객체를 인자로 받아서 사용된다.
- nullable 을 허용하지 않음

```kotlin
// fun <T, R> with(receiver: T, block: T.() -> R): R
fun main() = with(str) {
    println(toUpperCase())
    println(toLowerCase())
}

private val str: String = "TEST code"

// TEST CODE
// test code
```
<br/>
<br/>


## let
<code style="color: #eb5657;">run</code>, <code style="color: #eb5657;">with</code> 와 같은 동작을 하는 함수로, 수신 객체에 접근을 할때 <code style="color: #eb5657;">it</code> 을 사용해야 한다.
- null 체크 후 코드를 실행하거나 nullable 한 수신 객체를 다른 타입의 값으로 반환해야하는 경우 사용

```kotlin
// fun <T, R> T.let(block: (T) -> R): R
fun main() {
    val user = User().age?.let {
        var age = 10 + it.age
        age
    }
    println("$user")
}

data class User(
    var name: String = "AAA", 
    var age: Int? = 0
)

// User(name=AAA, age=10)
```
<br/>
<br/>


## also
수신 객체에 접근을 할때 <code style="color: #eb5657;">it</code> 을 사용해야하고 <code style="color: #eb5657;">apply</code> 와 동일하게 수신 객체 자신을 반환하는 함수이다.
- 수신 객체에 대한 프로퍼티 설정뿐만 아니라 유효성 검사와 같은 추가적인 작업 후 수신객체 자신을 반환해야 하는 경우 사용

```kotlin
// fun <T> T.also(block: (T) -> Unit): T
fun main(user: User) {
    val user = user.also {
        requireNotNull(user.age)
    }
}

data class User(
    var name: String = "AAA", 
    var age: Int = 0
)
```